<!DOCTYPE html>
<html>

<head>
  <title>MIDI test</title>
</head>
<script src="../sdk/WebAudioSDK.js"></script>
<script src="JZZ/JZZ.js"></script>
<script src="JZZ/JZZ.input.Kbd.js"></script>
<script src="JZZ/JZZ.synth.OSC.js"></script>
<script src="MidiKeyboard/main.js"></script>
<script src="MidiMonitor/main.js"></script>
<script src="../plugins/PureJS/GuitarTuner/main.js"></script>
<script src="../plugins/PureJS/PingPongDelay/main.js"></script>

<body>
</body>

<script>
  var ctx = new AudioContext();
  var piano1 = new JazzSoftMidiKeyboard(ctx, 'MidiKeyboard');
  var piano2 = new JazzSoftMidiKeyboard(ctx, 'MidiKeyboard');
  var monitor = new JazzSoftMidiMonitor(ctx, 'MidiMonitor');
  var tuner = new WasabiTunerMachine(ctx, '../plugins/PureJS/GuitarTuner');
  var delay = new WasabiPingPongDelay(ctx, '../plugins/PureJS/PingPongDelay');

  Promise.all([piano1.load(), piano2.load(), monitor.load(), tuner.load(), delay.load()]).then((nnn) => {
    const [piano1_, piano2_, monitor_, tuner_, delay_] = nnn;
    piano1.loadGui().then((elem) => {
      document.body.appendChild(elem);
      piano2.loadGui().then((elem) => { document.body.appendChild(elem); });
    });
    monitor.loadGui().then((elem) => { document.body.appendChild(elem); });
    tuner.loadGui().then((elem) => { document.body.appendChild(elem); });
    delay.loadGui().then((elem) => { document.body.appendChild(elem); });

    // MIDI connections
    piano1_.connectMidi(piano2_);
    piano2_.connectMidi(monitor_);

    // Audio connections
    piano2_.connect(tuner_);
    tuner_.connect(delay_);
    delay_.connect(ctx.destination);
  });
</script>

</html>